<!DOCTYPE html>
<html>
<head>
  <!--        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"-->
  <!--        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="-->
  <!--        crossorigin=""/>-->
  <!--        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"-->
  <!--        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="-->
  <!--        crossorigin=""></script>-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.2/heatmap.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-heatmap@1.0.0/leaflet-heatmap.min.js"></script>
  <script src="https://unpkg.com/leaflet-geometryutil@0.13.1/leaflet.geometryutil.min.js"></script>

  <style>
    #map { width: 900px; height: 800px; }
  </style>
</head>
<body>

<div id="map"></div>

<!--<script src="../fill_hex.js"></script>-->

<!--<script src="../static/gaussian.js"></script>-->
<!--<script src="../static/heatmap_smoke.js"></script>-->
<script src="{{ url_for('static', filename='gaussian.js') }}"></script>
<script src="{{ url_for('static', filename='heatmap_smoke.js') }}"></script>
<script>
  let startLat = 35.492082387322;
  let startLng = 129.327187114242;
  let factory = {
    latitude : 35.492082387322,
    longitude : 129.327187114242,
    SOx : 100,
    PM10 : 50,
    NOx : 150
  };
  let particle_type = 'SOx';
  let wind = {
    direction : 350,
    speed : 3.5
  };

  // 맵과 히트맵 레이어 초기화
  var map = L.map('map', {
    center: [startLat, startLng],
    zoom: 14,
  });

  // 타일 설정 ( OSM )
  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map);

  /* 울산 Geojson 파일 업로드  */
  fetch('{{ url_for('static', filename='ulsan_building_geo.geojson') }}')
  .then(response => response.json())
          .then(data => {
            console.log("GeoJSON data:", data);  // GeoJSON 데이터 출력
            var geojsonLayer = L.geoJSON(data, {
              style: function (feature) {
                return {
                  color: "#fc780d",
                  weight: 2,
                  opacity: 1
                };
              }
            });
            console.log("GeoJSON Layer:", geojsonLayer);  // GeoJSON 레이어 출력
            geojsonLayer.addTo(map);  // GeoJSON 레이어를 지도에 추가
          })
          .catch(error => console.log('Error loading GeoJSON:', error));

  // // 하나의 공장에서 나오는 매연을 히트맵으로 표현
  if (typeof addSmokeHeatmap_single === 'function') {
    addSmokeHeatmap_single(map, factory, particle_type, wind); //
  } else {
    console.error("addSmokeHeatmap_single 함수가 정의되지 않았습니다.");
  }

</script>
</body>
</html>